<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://foreops.com/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://foreops.com/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://foreops.com/main.d7bc1956fe5638836e64f38383fbd694033946b03a4b64f1d774da0489ad2999b7701a0201bea1bf79a558f3eb28c76188eb7793427ce940b0d87a1f59656f6e.css integrity="sha512-17wZVv5WOINuZPODg/vWlAM5RrA6S2Tx13TaBImtKZm3cBoCAb6hv3mlWPPrKMdhiOt3k0J86UCw2HofWWVvbg==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Container Scanning with Trivy in Jenkins - foreops_</title><meta name=description content="Container security scanning in Jenkins CI with Trivy"><link rel=canonical href=https://foreops.com/blog/trivy-intro/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/blog/trivy-intro/trivy-jenkins.png"><meta name=twitter:title content="Container Scanning with Trivy in Jenkins"><meta name=twitter:description content="Container security scanning in Jenkins CI with Trivy"><meta name=twitter:site content="@foreops_"><meta name=twitter:creator content="@foreops_"><meta property="og:title" content="Container Scanning with Trivy in Jenkins"><meta property="og:description" content="Container security scanning in Jenkins CI with Trivy"><meta property="og:type" content="article"><meta property="og:url" content="/blog/trivy-intro/"><meta property="og:image" content="/blog/trivy-intro/trivy-jenkins.png"><meta property="article:published_time" content="2021-07-02T11:00:00-04:00"><meta property="article:modified_time" content="2021-07-02T11:00:00-04:00"><meta property="og:site_name" content="foreops_"><meta property="article:publisher" content="https://www.facebook.com/foreops_"><meta property="article:author" content="https://www.facebook.com/foreops_"><meta property="og:locale" content="en_US"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"\/blog\/trivy-intro\/"},"headline":"Container Scanning with Trivy in Jenkins","image":["/blog/trivy-intro/trivy-jenkins.png"],"datePublished":"2021-07-02T11:00:00CET","dateModified":"2021-07-02T11:00:00CET","author":{"@type":"Organization","name":"foreops_"},"publisher":{"@type":"Organization","name":"foreops_","logo":{"@type":"ImageObject","url":"\/images\/foreops-logo.png"}},"description":"Container security scanning in Jenkins CI with Trivy"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/foreops.com\/"},{"@type":"ListItem","position":3,"name":"Blog","item":"https:\/\/foreops.com\/\/blog\/"},{"@type":"ListItem","position":4,"name":"Trivy Intro","item":"https:\/\/foreops.com\/\/blog\/trivy-intro\/"}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://foreops.com/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://foreops.com/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://foreops.com/favicon-16x16.png><link rel=manifest href=https://foreops.com/site.webmanifest></head><body class="blog single"><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=https://foreops.com/><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="120" viewBox="0 0 614.52 168.6" style="enable-background:new 0 0 614.52 168.6"><style>.st0{fill:red}.st1{fill:currentColor;stroke:currentColor;stroke-width:2.228;stroke-miterlimit:10}</style><rect x="524.08" y="121.45" class="st0" width="90.43" height="47.15"/><path class="st1" d="M43.24 52.84v10.98h29.78V75.9H43.24v44.18H28.69V75.9H5.78V63.82H28.7V53.53c0-12.62 2.86-22.07 8.58-28.33 5.72-6.27 14.34-9.4 25.86-9.4 5.21.0 10.25.46 15.09 1.37l-1.51 12.62c-5.4-.64-10.06-.96-14-.96C49.73 28.83 43.24 36.84 43.24 52.84z"/><path class="st1" d="M96.18 117.02c-4.78-2.95-8.42-7.25-10.91-12.9s-3.74-12.45-3.74-20.41 1.25-14.76 3.74-20.41c2.49-5.65 6.13-9.95 10.91-12.9 4.78-2.95 10.51-4.43 17.19-4.43 6.68.0 12.41 1.48 17.19 4.43s8.42 7.25 10.91 12.9c2.49 5.65 3.74 12.45 3.74 20.41s-1.25 14.76-3.74 20.41c-2.49 5.65-6.13 9.95-10.91 12.9s-10.51 4.43-17.19 4.43C106.69 121.45 100.96 119.98 96.18 117.02zM125.75 102c2.9-4.28 4.36-10.37 4.36-18.28s-1.45-14.01-4.36-18.28c-2.91-4.28-7.03-6.41-12.38-6.41s-9.48 2.14-12.38 6.41c-2.91 4.28-4.36 10.37-4.36 18.28s1.45 14.01 4.36 18.28c2.9 4.28 7.03 6.42 12.38 6.42C118.72 108.42 122.84 106.28 125.75 102z"/><path class="st1" d="M215.98 48.83c3.13 1.9 5.44 4.84 6.93 8.82s2.23 9.19 2.23 15.64h-14.41c0-5.26-.79-9.07-2.37-11.42-1.58-2.36-4.13-3.53-7.65-3.53-6.08.0-10.67 2.61-13.76 7.82-3.09 5.21-4.63 12.76-4.63 22.64V108h17.84v12.08h-48.57V108h16.19V59.43h-13.45V47.35h25.25l2.47 18.66h1.65c.41-6.72 2.27-11.74 5.59-15.06s8.13-4.97 14.44-4.97C208.76 45.98 212.84 46.93 215.98 48.83z"/><path class="st1" d="M295.39 90.17h-49.12c1.28 6.04 4.16 10.63 8.64 13.79 4.48 3.16 10.38 4.73 17.7 4.73 5.63.0 11.57-.64 17.84-1.92l1.78 12.76c-6.72 1.28-13.81 1.92-21.27 1.92-8.28.0-15.31-1.46-21.1-4.39s-10.19-7.21-13.21-12.86-4.53-12.52-4.53-20.62c0-7.87 1.28-14.61 3.84-20.24 2.56-5.63 6.3-9.92 11.22-12.9 4.92-2.97 10.83-4.46 17.73-4.46 9.88.0 17.5 3 22.85 8.99s8.03 14.61 8.03 25.86C295.81 84.17 295.67 87.28 295.39 90.17zM282.63 79.05c0-6.49-1.54-11.5-4.63-15.02-3.09-3.52-7.4-5.28-12.93-5.28-5.63.0-10.11 1.76-13.45 5.28-3.34 3.52-5.31 8.53-5.9 15.02h36.91z"/><path class="st1" d="M317.88 117.02c-4.78-2.95-8.42-7.25-10.91-12.9s-3.74-12.45-3.74-20.41 1.25-14.76 3.74-20.41c2.49-5.65 6.13-9.95 10.91-12.9 4.78-2.95 10.51-4.43 17.19-4.43s12.41 1.48 17.19 4.43 8.42 7.25 10.91 12.9c2.49 5.65 3.74 12.45 3.74 20.41s-1.25 14.76-3.74 20.41c-2.49 5.65-6.13 9.95-10.91 12.9-4.78 2.95-10.51 4.43-17.19 4.43C328.38 121.45 322.65 119.98 317.88 117.02zM347.44 102c2.9-4.28 4.36-10.37 4.36-18.28s-1.45-14.01-4.36-18.28c-2.9-4.28-7.03-6.41-12.38-6.41s-9.48 2.14-12.38 6.41c-2.9 4.28-4.36 10.37-4.36 18.28s1.45 14.01 4.36 18.28c2.9 4.28 7.03 6.42 12.38 6.42S344.54 106.28 347.44 102z"/><path class="st1" d="M427.38 50.48c4.37 3 7.68 7.38 9.95 13.14 2.26 5.76 3.4 12.69 3.4 20.79.0 7.91-1.13 14.64-3.4 20.17-2.26 5.54-5.56 9.73-9.88 12.59s-9.55 4.29-15.68 4.29c-5.58.0-10.08-1.08-13.52-3.22s-5.38-5.28-5.83-9.4h-1.37v42.81h-14.54V47.35h13.17l1.17 13.17h1.58c.64-4.89 2.55-8.54 5.73-10.94s7.67-3.6 13.48-3.6C417.77 45.98 423.01 47.48 427.38 50.48zm-5.31 52.38c2.83-4.16 4.25-10.31 4.25-18.46.0-8.32-1.45-14.75-4.36-19.28s-7.03-6.79-12.38-6.79c-12.35.0-18.52 6.95-18.52 20.86v17.56c0 8.23 6.13 12.35 18.39 12.35C415.02 109.1 419.23 107.02 422.07 102.86z"/><path class="st1" d="M454.56 120.97c-3.91-.32-7.44-.85-10.6-1.58l1.65-13.17c9.33 1.46 17.06 2.2 23.19 2.2 7.32.0 12.65-.72 15.99-2.16 3.34-1.44 5.01-3.74 5.01-6.9.0-2.1-.56-3.71-1.68-4.8-1.12-1.1-2.94-1.97-5.45-2.61l-16.74-4.25c-4.67-1.19-8.39-2.56-11.18-4.12-2.79-1.55-4.87-3.53-6.24-5.93-1.37-2.4-2.06-5.41-2.06-9.02.0-5.35 1.29-9.68 3.88-13 2.58-3.32 6.61-5.75 12.08-7.31 5.46-1.55 12.59-2.33 21.37-2.33 6.68.0 13.08.46 19.21 1.37l-1.51 12.62c-6.91-.64-12.94-.96-18.11-.96-7.68.0-13.24.7-16.67 2.09-3.43 1.4-5.15 3.67-5.15 6.83.0 2.01.59 3.52 1.78 4.53s3.2 1.88 6.04 2.61l13.45 3.29c5.21 1.28 9.42 2.79 12.62 4.53s5.58 3.91 7.13 6.52 2.33 5.83 2.33 9.67c0 5.26-1.26 9.53-3.77 12.79-2.52 3.27-6.42 5.68-11.7 7.24-5.28 1.55-12.16 2.33-20.62 2.33C463.22 121.45 458.47 121.29 454.56 120.97z"/><rect x="11.19" y="108.13" class="st1" width="50.78" height="12"/></svg></a><button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://twitter.com/foreops_><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg><span class="ms-2 visually-hidden">Twitter</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/foreops><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class="nav-item active"><a class=nav-link href=https://foreops.com/blog/>Blog</a></li></ul><div class="break order-6 d-md-none"></div><form class="navbar-form flex-grow-1 order-7 order-md-3"><input id=userinput class="form-control is-search" type=search placeholder=Search... aria-label=Search... autocomplete=off><div id=suggestions class="shadow bg-white rounded"></div></form></div></div></header><div class="wrap container" role=document><div class=content><div class="row justify-content-center"><div class="col-md-12 col-lg-10 col-xl-8"><article><div class=blog-header><h1>Container Scanning with Trivy in Jenkins</h1><p><small>Posted July 2, 2021 by <a class="stretched-link position-relative" href=https://foreops.com/contributors/faheem-memon/>Faheem Memon</a>&nbsp;&dash;&nbsp;<strong>4&nbsp;min read</strong></small><p><a href=https://foreops.com/tags/container/>#container</a>
<a href=https://foreops.com/tags/scanner/>#scanner</a>
<a href=https://foreops.com/tags/security/>#security</a>
<a href=https://foreops.com/tags/trivy/>#trivy</a></div><p class=lead>With unrelenting attacks from malicious hackers on business critical software and infrastructure, the "Shift-left" approach for security testing is gaining more momentum inside the enterprises.</p><p>You can identify and address the security vulnerabilities earlier in the software development life-cycle if you integrate a scanner in the continuous integration (CI) pipelines. There are multiple open-source and commercial tools out there that can scan the applications and containers. When comparing these tools, we consider the following aspects:</p><ol><li>Easier integration with the pipelines through plugins, scripts, or API calls.</li><li>Faster, ideally synchronous execution. It should not hold up the build pipeline.</li><li>Ability to easily ignore false positives, unfixable, and realized vulnerabilities.</li><li>Audit report access from the pipeline and roll-up at the organizational level.</li><li>Ability to run tests from developer machines easily</li></ol><p>CI pipeline integration is often just one part of an enterprise security toolchain. Tools like AquaSecurity, Prisma, Snyk, and others provide additional features such as periodic re-scanning, run-time monitoring, alerting, and a centralized dashboard for the security teams. In this blog post, however, we will look into <a href=https://github.com/aquasecurity/trivy>Trivy</a>. Trivy is an open-source scanner from the AquaSecurity team that can scan container images or filesystem paths for vulnerable operating system packages or application dependencies.</p><figure class=wide><img class="img-fluid lazyload blur-up" data-sizes=auto src=https://foreops.com/blog/trivy-intro/trivy-highlight_hueaa312ec703a544d1f6222b224c34b98_621057_20x0_resize_box_2.png data-srcset="https://foreops.com/blog/trivy-intro/trivy-highlight_hueaa312ec703a544d1f6222b224c34b98_621057_900x0_resize_box_2.png 900w,https://foreops.com/blog/trivy-intro/trivy-highlight_hueaa312ec703a544d1f6222b224c34b98_621057_800x0_resize_box_2.png 800w,https://foreops.com/blog/trivy-intro/trivy-highlight_hueaa312ec703a544d1f6222b224c34b98_621057_700x0_resize_box_2.png 700w,https://foreops.com/blog/trivy-intro/trivy-highlight_hueaa312ec703a544d1f6222b224c34b98_621057_600x0_resize_box_2.png 600w,https://foreops.com/blog/trivy-intro/trivy-highlight_hueaa312ec703a544d1f6222b224c34b98_621057_500x0_resize_box_2.png 500w" width=813 height=450 alt="Trivy: A simple and comprehensive vulernerability"><noscript><img class=img-fluid sizes=100vw srcset="https://foreops.com/blog/trivy-intro/trivy-highlight_hueaa312ec703a544d1f6222b224c34b98_621057_900x0_resize_box_2.png 900w,https://foreops.com/blog/trivy-intro/trivy-highlight_hueaa312ec703a544d1f6222b224c34b98_621057_800x0_resize_box_2.png 800w,https://foreops.com/blog/trivy-intro/trivy-highlight_hueaa312ec703a544d1f6222b224c34b98_621057_700x0_resize_box_2.png 700w,https://foreops.com/blog/trivy-intro/trivy-highlight_hueaa312ec703a544d1f6222b224c34b98_621057_600x0_resize_box_2.png 600w,https://foreops.com/blog/trivy-intro/trivy-highlight_hueaa312ec703a544d1f6222b224c34b98_621057_500x0_resize_box_2.png 500w" src=https://foreops.com/blog/trivy-intro/trivy-highlight.png width=813 height=450 alt="Trivy: A simple and comprehensive vulernerability"></noscript></figure><p>Let&rsquo;s review our scanner selection criteria with Trivy.</p><h3 id=getting-started>Getting Started</h3><p>Let&rsquo;s download <code>trivy</code> CLI and test it on our local machine:</p><pre><code class=language-bash>$ curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/install.sh | sh -s -- -b /usr/local/bin v0.18.3
aquasecurity/trivy info checking GitHub for tag 'v0.18.3'
aquasecurity/trivy info found version: 0.18.3 for v0.18.3/macOS/64bit
aquasecurity/trivy info installed /usr/local/bin/trivy
</code></pre><p>There are several binaries available for <code>*-nix</code> based systems. If you can&rsquo;t find the right binary, you have an option to use the <a href=https://hub.docker.com/r/aquasec/trivy><code>aquasec/trivy</code></a> container instead. First, let&rsquo;s take a quick look at the CLI.</p><pre><code class=language-bash>$ trivy --help
NAME:
   trivy - A simple and comprehensive vulnerability scanner for containers

USAGE:
   trivy [global options] command [command options] target

VERSION:
   0.18.3

COMMANDS:
   image, i          scan an image
   filesystem, fs    scan local filesystem
   repository, repo  scan remote repository
   client, c         client mode
   server, s         server mode
   plugin, p         manage plugins
   help, h           Shows a list of commands or help for one command

GLOBAL OPTIONS:
   --quiet, -q        suppress progress bar and log output (default: false) [$TRIVY_QUIET]
   --debug, -d        debug mode (default: false) [$TRIVY_DEBUG]
   --cache-dir value  cache directory (default: &quot;/Users/faheem/Library/Caches/trivy&quot;) [$TRIVY_CACHE_DIR]
   --help, -h         show help (default: false)
   --version, -v      print the version (default: false)
</code></pre><p>When you run a scan, trivy will automatically download the vulnerabilities database and cache it for 12 hours. The database can also be downloaded separately if required.</p><p>Let&rsquo;s take <code>trivy</code> for a spin and see it in action.</p><pre><code class=language-bash>trivy image node:8-alpine
</code></pre><figure class=wide><img class="img-fluid lazyload blur-up" data-sizes=auto src=https://foreops.com/blog/trivy-intro/trivy-scan-cli_huabd21dc3cd28384b4481f931a262a2bd_572718_20x0_resize_box_2.png data-srcset="https://foreops.com/blog/trivy-intro/trivy-scan-cli_huabd21dc3cd28384b4481f931a262a2bd_572718_900x0_resize_box_2.png 900w,https://foreops.com/blog/trivy-intro/trivy-scan-cli_huabd21dc3cd28384b4481f931a262a2bd_572718_800x0_resize_box_2.png 800w,https://foreops.com/blog/trivy-intro/trivy-scan-cli_huabd21dc3cd28384b4481f931a262a2bd_572718_700x0_resize_box_2.png 700w,https://foreops.com/blog/trivy-intro/trivy-scan-cli_huabd21dc3cd28384b4481f931a262a2bd_572718_600x0_resize_box_2.png 600w,https://foreops.com/blog/trivy-intro/trivy-scan-cli_huabd21dc3cd28384b4481f931a262a2bd_572718_500x0_resize_box_2.png 500w" width=2308 height=1502 alt="trivy image node:8-alpine"><noscript><img class=img-fluid sizes=100vw srcset="https://foreops.com/blog/trivy-intro/trivy-scan-cli_huabd21dc3cd28384b4481f931a262a2bd_572718_900x0_resize_box_2.png 900w,https://foreops.com/blog/trivy-intro/trivy-scan-cli_huabd21dc3cd28384b4481f931a262a2bd_572718_800x0_resize_box_2.png 800w,https://foreops.com/blog/trivy-intro/trivy-scan-cli_huabd21dc3cd28384b4481f931a262a2bd_572718_700x0_resize_box_2.png 700w,https://foreops.com/blog/trivy-intro/trivy-scan-cli_huabd21dc3cd28384b4481f931a262a2bd_572718_600x0_resize_box_2.png 600w,https://foreops.com/blog/trivy-intro/trivy-scan-cli_huabd21dc3cd28384b4481f931a262a2bd_572718_500x0_resize_box_2.png 500w" src=https://foreops.com/blog/trivy-intro/trivy-scan-cli.png width=2308 height=1502 alt="trivy image node:8-alpine"></noscript><figcaption class=figure-caption>Trivy Scan Report</figcaption></figure><p><code>node:11-alpine</code> seems to have several security vulnerabilities, including a few CRITICAL and HIGH. However, all of them are identified in the underlined <code>Alpine 3.9.4</code> operating system since we have not deployed any custom applications inside the container. Trivy can differentiate between OS and application dependency base vulnerabilities.</p><p>By default, Trivy generates a tabular output on the CLI, but it supports templating, and you can generate reports in multiple formats including HTML file type. Let&rsquo;s create an HTML report for the last run.</p><pre><code class=language-bash>wget https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/html.tpl
trivy image --format template --template @./html.tpl -o report.html node:11-alpine
</code></pre><figure class=wide><img class="img-fluid lazyload blur-up" data-sizes=auto src=https://foreops.com/blog/trivy-intro/trivy-scan-html_hu2bc134aca7c82d159ae67a90a3a688cc_960235_20x0_resize_box_2.png data-srcset="https://foreops.com/blog/trivy-intro/trivy-scan-html_hu2bc134aca7c82d159ae67a90a3a688cc_960235_900x0_resize_box_2.png 900w,https://foreops.com/blog/trivy-intro/trivy-scan-html_hu2bc134aca7c82d159ae67a90a3a688cc_960235_800x0_resize_box_2.png 800w,https://foreops.com/blog/trivy-intro/trivy-scan-html_hu2bc134aca7c82d159ae67a90a3a688cc_960235_700x0_resize_box_2.png 700w,https://foreops.com/blog/trivy-intro/trivy-scan-html_hu2bc134aca7c82d159ae67a90a3a688cc_960235_600x0_resize_box_2.png 600w,https://foreops.com/blog/trivy-intro/trivy-scan-html_hu2bc134aca7c82d159ae67a90a3a688cc_960235_500x0_resize_box_2.png 500w" width=2618 height=1640 alt="trivy image node:8-alpine"><noscript><img class=img-fluid sizes=100vw srcset="https://foreops.com/blog/trivy-intro/trivy-scan-html_hu2bc134aca7c82d159ae67a90a3a688cc_960235_900x0_resize_box_2.png 900w,https://foreops.com/blog/trivy-intro/trivy-scan-html_hu2bc134aca7c82d159ae67a90a3a688cc_960235_800x0_resize_box_2.png 800w,https://foreops.com/blog/trivy-intro/trivy-scan-html_hu2bc134aca7c82d159ae67a90a3a688cc_960235_700x0_resize_box_2.png 700w,https://foreops.com/blog/trivy-intro/trivy-scan-html_hu2bc134aca7c82d159ae67a90a3a688cc_960235_600x0_resize_box_2.png 600w,https://foreops.com/blog/trivy-intro/trivy-scan-html_hu2bc134aca7c82d159ae67a90a3a688cc_960235_500x0_resize_box_2.png 500w" src=https://foreops.com/blog/trivy-intro/trivy-scan-html.png width=2618 height=1640 alt="trivy image node:8-alpine"></noscript><figcaption class=figure-caption>Trivy Scan HTML Report</figcaption></figure><h3 id=jenkins-integration>Jenkins Integration</h3><p>Let&rsquo;s add a scanning feature in our <code>Jenkinsfile</code>:</p><pre><code class=language-jenkinsfile>...
        stage('Scan') {
            steps {
                // Install trivy
                sh 'curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/install.sh | sh -s -- -b /usr/local/bin v0.18.3'
                sh 'curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/html.tpl &gt; html.tpl'

                // Scan all vuln levels
                sh 'mkdir -p reports'
                sh 'trivy filesystem --ignore-unfixed --vuln-type os,library --format template --template &quot;@html.tpl&quot; -o reports/nodjs-scan.html ./nodejs'
                publishHTML target : [
                    allowMissing: true,
                    alwaysLinkToLastBuild: true,
                    keepAll: true,
                    reportDir: 'reports',
                    reportFiles: 'nodjs-scan.html',
                    reportName: 'Trivy Scan',
                    reportTitles: 'Trivy Scan'
                ]

                // Scan again and fail on CRITICAL vulns
                sh 'trivy filesystem --ignore-unfixed --vuln-type os,library --exit-code 1 --severity CRITICAL ./nodejs'

            }
...
</code></pre><figure class=wide><img class="img-fluid lazyload blur-up" data-sizes=auto src=https://foreops.com/blog/trivy-intro/trivy-scan-jenkins_hu09fc35e574777a6d796d9db5b7b061b2_599144_20x0_resize_box_2.png data-srcset="https://foreops.com/blog/trivy-intro/trivy-scan-jenkins_hu09fc35e574777a6d796d9db5b7b061b2_599144_900x0_resize_box_2.png 900w,https://foreops.com/blog/trivy-intro/trivy-scan-jenkins_hu09fc35e574777a6d796d9db5b7b061b2_599144_800x0_resize_box_2.png 800w,https://foreops.com/blog/trivy-intro/trivy-scan-jenkins_hu09fc35e574777a6d796d9db5b7b061b2_599144_700x0_resize_box_2.png 700w,https://foreops.com/blog/trivy-intro/trivy-scan-jenkins_hu09fc35e574777a6d796d9db5b7b061b2_599144_600x0_resize_box_2.png 600w,https://foreops.com/blog/trivy-intro/trivy-scan-jenkins_hu09fc35e574777a6d796d9db5b7b061b2_599144_500x0_resize_box_2.png 500w" width=2233 height=1773 alt="trivy image node:8-alpine"><noscript><img class=img-fluid sizes=100vw srcset="https://foreops.com/blog/trivy-intro/trivy-scan-jenkins_hu09fc35e574777a6d796d9db5b7b061b2_599144_900x0_resize_box_2.png 900w,https://foreops.com/blog/trivy-intro/trivy-scan-jenkins_hu09fc35e574777a6d796d9db5b7b061b2_599144_800x0_resize_box_2.png 800w,https://foreops.com/blog/trivy-intro/trivy-scan-jenkins_hu09fc35e574777a6d796d9db5b7b061b2_599144_700x0_resize_box_2.png 700w,https://foreops.com/blog/trivy-intro/trivy-scan-jenkins_hu09fc35e574777a6d796d9db5b7b061b2_599144_600x0_resize_box_2.png 600w,https://foreops.com/blog/trivy-intro/trivy-scan-jenkins_hu09fc35e574777a6d796d9db5b7b061b2_599144_500x0_resize_box_2.png 500w" src=https://foreops.com/blog/trivy-intro/trivy-scan-jenkins.png width=2233 height=1773 alt="trivy image node:8-alpine"></noscript><figcaption class=figure-caption>Trivy Scan HTML Report</figcaption></figure><p>The script downloads and runs the scanner on a <a href=https://github.com/faheem556/funfact>nodejs</a> application path. It runs the scan twice, the second time from the previous cache, and fails the build if it discovers are any CRITICAL vulnerabilities. Finally, the report to the pipeline using <a href=https://plugins.jenkins.io/htmlpublisher/>HTML Publisher</a> plugin.</p><p>You can manage false positives through <a href=https://aquasecurity.github.io/trivy/v0.18.3/examples/filter/#by-vulnerability-ids><code>.trivyignore</code></a> file. So you can check in your <code>.trivyignore</code> file and the scan step in Jenkins pipeline will pick it up automatically.</p><p>Trivy is a fast, lightweight, and user-friendly scanner that can easily integrate in any environment.</p><p>Further Reading:</p><ol><li><a href=https://en.wikipedia.org/wiki/Shift-left_testing>https://en.wikipedia.org/wiki/Shift-left_testing</a></li><li><a href=https://aquasecurity.github.io/trivy/v0.18.3/>https://aquasecurity.github.io/trivy/v0.18.3/</a></li><li><a href=https://github.com/aquasecurity/trivy>https://github.com/aquasecurity/trivy</a></li><li><a href=https://aquasecurity.github.io/trivy/v0.18.3/comparison/>https://aquasecurity.github.io/trivy/v0.18.3/comparison/</a></li><li><a href=https://aquasecurity.github.io/trivy/v0.18.3/air-gap/>https://aquasecurity.github.io/trivy/v0.18.3/air-gap/</a></li><li><a href=https://hub.docker.com/r/aquasec/trivy>https://hub.docker.com/r/aquasec/trivy</a></li></ol></article></div></div></div></div><footer class="footer text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a href=https://gohugo.io/>Hugo</a>, and <a href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline><li class=list-inline-item><a href=https://foreops.com/contact/>Contact</a></li><li class=list-inline-item><a href=https://foreops.com/contributors/>Contributors</a></li></ul></div></div></div></footer><script src=https://foreops.com/js/highlight.min.382135534ad7d5f348b8dcfbfd466fa7ff0ec4f4c9a43d9a72481c3aff322fe18adeb357aedbd71da568005af873b74f0dbb23cc022f8d04f144991f6f04cb00.js integrity="sha512-OCE1U0rX1fNIuNz7/UZvp/8OxPTJpD2ackgcOv8yL+GK3rNXrtvXHaVoAFr4c7dPDbsjzAIvjQTxRJkfbwTLAA==" crossorigin=anonymous defer></script><script src=https://foreops.com/main.min.cb1cfa565384689404329cbf8ad4a175b59ac6421a528ad947882d8242fc7b62b773cd5967a10349256154f6a67bcdeeb3da0729191ddd4f5623442999e53004.js integrity="sha512-yxz6VlOEaJQEMpy/itShdbWaxkIaUorZR4gtgkL8e2K3c81ZZ6EDSSVhVPame83us9oHKRkd3U9WI0QpmeUwBA==" crossorigin=anonymous defer></script><script src=https://foreops.com/index.min.e02968cfc40d4b5395bf2489e2c574b30d55e9b0bfdb6f8ca7e68d0281e56877eef97cc9fedff0f0c71376068ed68392c88e7dea0f7bfdeda28d3b2613d757bb.js integrity="sha512-4Cloz8QNS1OVvySJ4sV0sw1V6bC/22+Mp+aNAoHlaHfu+XzJ/t/w8McTdgaO1oOSyI596g97/e2ijTsmE9dXuw==" crossorigin=anonymous defer></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-170884460-1','auto'),ga('send','pageview'))</script></body></html>